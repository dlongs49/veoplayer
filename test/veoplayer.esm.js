const error_close =   `
<svg title="加载中..." viewBox="0 0 1035 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
             width="16" height="16">
            <path
                d="M868.248009 806.105382c17.398599 17.398599 17.398599 45.612844 0 63.011443-8.699299 8.699299-20.105295 13.054519-31.500152 13.054519s-22.800853-4.355219-31.500152-13.054519L517.491363 581.360484 229.735022 869.116825c-8.699299 8.699299-20.105295 13.054519-31.500153 13.054519s-22.800853-4.355219-31.500152-13.054519c-17.398599-17.398599-17.398599-45.612844 0-63.011443l287.745203-287.756341-287.756342-287.756342c-17.398599-17.398599-17.398599-45.612844 0-63.011443s45.612844-17.398599 63.011444 0l287.756341 287.756341 287.745203-287.745203c17.398599-17.398599 45.612844-17.398599 63.011443 0s17.398599 45.612844 0 63.011444L580.491668 518.360179l287.756341 287.756342z"
                fill="#bfbfbf"></path>
        </svg>
`;

const error_time = `
<svg t="1687447759050" title="失败" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6954" width="18" height="18"><path d="M939.3 775.2L589.7 169.8c-42.7-74-112.6-74-155.4 0L84.8 775.2C42 849.3 77 909.7 162.4 909.7h699.2c85.4 0 120.4-60.4 77.7-134.5z m-384 0.8c-9.3 9.1-20 14.6-31.9 16.7-3.8 0.2-7.5 0.3-11.4 0.3s-7.6-0.1-11.4-0.3c-12-2.1-22.6-7.7-31.9-16.7-12.1-11.9-18.1-26.1-18.1-43 0-16.7 6-31.2 18.1-43.3 12.1-12.1 26.6-18.2 43.3-18.2 16.7 0 31.2 6.1 43.3 18.2 12.1 12.1 18.1 26.6 18.1 43.3 0.1 16.8-5.9 31.2-18.1 43z m-13.9-141.3h-57.7c-7-85.4-33-202.8-33-218.8 0-18.3 5.7-33.7 17.2-46.1 11.6-12.5 26.2-18.8 44.2-18.8 17.9 0 32.6 6.2 44.2 18.5 11.5 12.4 17.2 27.8 17.2 46.4 0 16-24 133.4-32.1 218.8z" fill="#ffffff" p-id="6955"></path></svg>`;

const veo_loading = `
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
style="margin: auto; background: none; display: block; shape-rendering: auto;" width="50px" height="50px"
viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">
<g transform="translate(84,50)">
   <g transform="rotate(0)">
       <circle cx="0" cy="0" r="6" fill="#e1e1e1" fill-opacity="1">
           <animateTransform attributeName="transform" type="scale" begin="-0.875s" values="1.5 1.5;1 1"
                             keyTimes="0;1" dur="1s" repeatCount="indefinite"></animateTransform>
           <animate attributeName="fill-opacity" keyTimes="0;1" dur="1s" repeatCount="indefinite"
                    values="1;0" begin="-0.875s"></animate>
       </circle>
   </g>
</g>
<g transform="translate(74.04163056034261,74.04163056034261)">
   <g transform="rotate(45)">
       <circle cx="0" cy="0" r="6" fill="#e1e1e1" fill-opacity="0.875">
           <animateTransform attributeName="transform" type="scale" begin="-0.75s" values="1.5 1.5;1 1"
                             keyTimes="0;1" dur="1s" repeatCount="indefinite"></animateTransform>
           <animate attributeName="fill-opacity" keyTimes="0;1" dur="1s" repeatCount="indefinite"
                    values="1;0" begin="-0.75s"></animate>
       </circle>
   </g>
</g>
<g transform="translate(50,84)">
   <g transform="rotate(90)">
       <circle cx="0" cy="0" r="6" fill="#e1e1e1" fill-opacity="0.75">
           <animateTransform attributeName="transform" type="scale" begin="-0.625s" values="1.5 1.5;1 1"
                             keyTimes="0;1" dur="1s" repeatCount="indefinite"></animateTransform>
           <animate attributeName="fill-opacity" keyTimes="0;1" dur="1s" repeatCount="indefinite"
                    values="1;0" begin="-0.625s"></animate>
       </circle>
   </g>
</g>
<g transform="translate(25.958369439657385,74.04163056034261)">
   <g transform="rotate(135)">
       <circle cx="0" cy="0" r="6" fill="#e1e1e1" fill-opacity="0.625">
           <animateTransform attributeName="transform" type="scale" begin="-0.5s" values="1.5 1.5;1 1"
                             keyTimes="0;1" dur="1s" repeatCount="indefinite"></animateTransform>
           <animate attributeName="fill-opacity" keyTimes="0;1" dur="1s" repeatCount="indefinite"
                    values="1;0" begin="-0.5s"></animate>
       </circle>
   </g>
</g>
<g transform="translate(16,50.00000000000001)">
   <g transform="rotate(180)">
       <circle cx="0" cy="0" r="6" fill="#e1e1e1" fill-opacity="0.5">
           <animateTransform attributeName="transform" type="scale" begin="-0.375s" values="1.5 1.5;1 1"
                             keyTimes="0;1" dur="1s" repeatCount="indefinite"></animateTransform>
           <animate attributeName="fill-opacity" keyTimes="0;1" dur="1s" repeatCount="indefinite"
                    values="1;0" begin="-0.375s"></animate>
       </circle>
   </g>
</g>
<g transform="translate(25.95836943965738,25.958369439657385)">
   <g transform="rotate(225)">
       <circle cx="0" cy="0" r="6" fill="#e1e1e1" fill-opacity="0.375">
           <animateTransform attributeName="transform" type="scale" begin="-0.25s" values="1.5 1.5;1 1"
                             keyTimes="0;1" dur="1s" repeatCount="indefinite"></animateTransform>
           <animate attributeName="fill-opacity" keyTimes="0;1" dur="1s" repeatCount="indefinite"
                    values="1;0" begin="-0.25s"></animate>
       </circle>
   </g>
</g>
<g transform="translate(49.99999999999999,16)">
   <g transform="rotate(270)">
       <circle cx="0" cy="0" r="6" fill="#e1e1e1" fill-opacity="0.25">
           <animateTransform attributeName="transform" type="scale" begin="-0.125s" values="1.5 1.5;1 1"
                             keyTimes="0;1" dur="1s" repeatCount="indefinite"></animateTransform>
           <animate attributeName="fill-opacity" keyTimes="0;1" dur="1s" repeatCount="indefinite"
                    values="1;0" begin="-0.125s"></animate>
       </circle>
   </g>
</g>
<g transform="translate(74.04163056034261,25.95836943965738)">
   <g transform="rotate(315)">
       <circle cx="0" cy="0" r="6" fill="#e1e1e1" fill-opacity="0.125">
           <animateTransform attributeName="transform" type="scale" begin="0s" values="1.5 1.5;1 1"
                             keyTimes="0;1" dur="1s" repeatCount="indefinite"></animateTransform>
           <animate attributeName="fill-opacity" keyTimes="0;1" dur="1s" repeatCount="indefinite"
                    values="1;0" begin="0s"></animate>
       </circle>
   </g>
</g>
<!-- [ldio] generated by https://loading.io/ --></svg>
`;

const time_loading = `

<?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  width="18px" height="18px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">
<g transform="rotate(0 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-1.4854111405835542s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(12.413793103448276 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-1.4323607427055702s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(24.82758620689655 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-1.379310344827586s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(37.241379310344826 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-1.326259946949602s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(49.6551724137931 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-1.273209549071618s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(62.06896551724138 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-1.2201591511936338s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(74.48275862068965 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-1.1671087533156497s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(86.89655172413794 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-1.1140583554376657s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(99.3103448275862 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-1.0610079575596816s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(111.72413793103448 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-1.0079575596816976s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(124.13793103448276 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.9549071618037135s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(136.55172413793105 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.9018567639257293s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(148.9655172413793 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.8488063660477453s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(161.3793103448276 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.7957559681697612s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(173.79310344827587 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.7427055702917771s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(186.20689655172413 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.689655172413793s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(198.6206896551724 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.636604774535809s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(211.0344827586207 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.5835543766578248s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(223.44827586206895 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.5305039787798408s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(235.86206896551724 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.47745358090185674s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(248.27586206896552 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.42440318302387264s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(260.6896551724138 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.37135278514588854s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(273.1034482758621 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.3183023872679045s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(285.51724137931035 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.2652519893899204s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(297.9310344827586 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.21220159151193632s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(310.3448275862069 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.15915119363395225s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(322.7586206896552 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.10610079575596816s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(335.17241379310343 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="-0.05305039787798408s" repeatCount="indefinite"></animate>
  </rect>
</g><g transform="rotate(347.58620689655174 50 50)">
  <rect x="43" y="8" rx="7" ry="8" width="14" height="16" fill="rgba(255, 255, 255, 0.5733870967741935)">
    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1.5384615384615383s" begin="0s" repeatCount="indefinite"></animate>
  </rect>
</g>
<!-- [ldio] generated by https://loading.io/ --></svg>
`;

const play = `
<svg version="1.1" id="播放" xmlns="http://www.w3.org/2000/svg"
	xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	width="100px" height="100px" viewBox="0 0 100 100"
	xml:space="preserve">
<path d="M8.08,50.73v-37.4c0-7.07,7.58-11.38,13.62-7.93l32.4,18.79l32.4,18.79c6.03,3.45,6.03,12.24,0,15.68L54.1,77.27
	l-32.4,18.79c-6.03,3.45-13.62-0.86-13.62-7.93C8.08,88.13,8.08,50.73,8.08,50.73z"/>
</svg>
`;
const pause = `
<svg version="1.1" id="暂停" xmlns="http://www.w3.org/2000/svg"
	xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	width="100px" height="100px" viewBox="0 0 100 100"
	xml:space="preserve">
<path d="M26.72,9.21h-7.59c-2.6,0-4.71,2.11-4.71,4.71v72.17c0,2.6,2.11,4.71,4.71,4.71h7.59c2.6,0,4.71-2.11,4.71-4.71V13.92
	C31.43,11.32,29.32,9.21,26.72,9.21z M77.68,9.21H70.1c-2.6,0-4.71,2.11-4.71,4.71v72.17c0,2.6,2.11,4.71,4.71,4.71h7.59
	c2.6,0,4.71-2.11,4.71-4.71V13.92C82.39,11.32,80.28,9.21,77.68,9.21z"/>
</svg>
`;
const play_mutual = `
<svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%">
<path class="ytp-svg-fill" d="M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z"></path></svg>
`;
const pause_mutual = `	
<svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%"><use class="ytp-svg-shadow" xlink:href="#ytp-id-469"></use><path class="ytp-svg-fill" d="M 12,26 16,26 16,10 12,10 z M 21,26 25,26 25,10 21,10 z"></path></svg>
`;

const strike = `
<svg version="1.1" id="勾选" xmlns="http://www.w3.org/2000/svg"
xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
width="100px" height="100px" viewBox="0 0 100 100"
style="enable-background:new 0 0 100 100;" xml:space="preserve">
<path
d="M85.71,22.07l12.45,12.3L42.74,86.51c-2.98,2.81-7.64,2.79-10.6-0.03L1.8,57.64l0,0l12.31-12.42l23.17,22.41L85.71,22.07z"
/>
</svg>
`;

const download = `
<svg version="1.1" id="下载" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                         width="100px" height="100px" viewBox="0 0 100 100"
                         xml:space="preserve">
<path d="M49.86,14.14c13.1,0,24.71,8.44,28.76,20.9c13.5,3.37,21.72,17.05,18.35,30.55C94.4,75.9,85.64,83.49,75.06,84.56
	l-0.01,0.13H24.67v-0.13C10.82,83.18,0.72,70.84,2.1,56.99c1.06-10.6,8.66-19.38,19-21.95C25.15,22.58,36.76,14.14,49.86,14.14z
	 M49.86,21.7c-9.43,0-17.88,5.83-21.21,14.65l-0.35,1.02l-1.3,4l-4.08,1.01c-9.45,2.36-15.2,11.95-12.84,21.4
	c1.72,6.87,7.38,12.05,14.38,13.15l0.96,0.12l0.91,0.09H73.4l0.91-0.09c8.64-0.87,15.36-7.91,15.84-16.58l0.03-0.97
	c0-7.74-5.05-14.58-12.45-16.86l-0.92-0.25l-4.07-1.01l-1.3-4C68.4,28.03,59.69,21.7,49.86,21.7L49.86,21.7z"/>
                        <path  d="M49.86,35.56c1.89,0,3.49,1.39,3.74,3.27l0.04,0.51V56.1l2.69-2.69c1.34-1.34,3.45-1.48,4.96-0.34l0.39,0.34
	c1.34,1.34,1.48,3.45,0.34,4.96l-0.34,0.39l-9.26,9.26c-1.34,1.34-3.45,1.48-4.96,0.34l-0.39-0.34l-9.27-9.26
	c-1.48-1.47-1.49-3.86-0.02-5.34c1.34-1.35,3.47-1.49,4.98-0.34l0.39,0.34l2.94,2.94V39.34C46.08,37.25,47.77,35.56,49.86,35.56
	L49.86,35.56L49.86,35.56z"/>
</svg>
`;

const setting = `
<svg version="1.1" id="设置" xmlns="http://www.w3.org/2000/svg"
xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
width="100px" height="100px" viewBox="0 0 100 100"
xml:space="preserve">
<g transform="matrix(-1,1.7320507764816284,-1.7320507764816284,-1,95.56922149658203,12.430780410766602)">
<g transform="matrix(1,0,0,1,23.988000869750977,24.02400016784668)">
<path d="M7.75-32.08l9.69,5.6c2.49,1.44,4.02,4.09,4.02,6.96v11.19c0,2.87-1.53,5.53-4.02,6.96l-9.69,5.6
c-2.49,1.44-5.55,1.44-8.04,0l-9.69-5.6C-12.47-2.8-14-5.45-14-8.33l0-11.19c0-2.87,1.53-5.53,4.02-6.96l9.69-5.6
C2.2-33.51,5.27-33.51,7.75-32.08z M-2.73-36.3l-9.69,5.6c-4,2.31-6.46,6.57-6.46,11.19v11.19c0,4.62,2.46,8.88,6.46,11.19
l9.69,5.6c4,2.31,8.92,2.31,12.92,0l9.69-5.6c4-2.31,6.46-6.57,6.46-11.19v-11.19c0-4.62-2.46-8.88-6.46-11.19l-9.69-5.6
C6.19-38.61,1.27-38.61-2.73-36.3z"/>
</g>
</g>
<g transform="matrix(2,0,0,2,-18,-18)">
<g transform="matrix(1,0,0,1,23.98900032043457,24.02400016784668)">
<path  d="M6.36,10.25c0-2.12,1.72-3.83,3.83-3.83s3.83,1.71,3.83,3.83s-1.71,3.83-3.83,3.83S6.36,12.36,6.36,10.25z
M1.48,10.25c0,4.81,3.9,8.72,8.71,8.72s8.71-3.9,8.71-8.72c0-4.81-3.9-8.71-8.71-8.71S1.48,5.44,1.48,10.25z"/>
</g>
</g>
</svg>
`;

const capture = `
<svg version="1.1" id="截图" xmlns="http://www.w3.org/2000/svg"
                         xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                         width="100px" height="100px" viewBox="0 0 100 100"
                         xml:space="preserve">
<path d="M60.77,7.61c4.52,0,8.76,2.11,11.39,5.65l0,0l1.89,2.55l1.41,0.13c3.9,0.41,6.7,1.19,9.53,2.55l0,0l0.78,0.39
	c4.31,2.22,7.72,5.5,10.02,9.66c2.54,4.58,3.43,8.99,3.43,18.18l0,0v12.99c0,9.19-0.88,13.6-3.43,18.18
	c-2.3,4.15-5.71,7.44-10.02,9.66c-4.75,2.45-9.33,3.3-18.86,3.3l0,0H33.48c-9.53,0-14.11-0.85-18.86-3.3
	c-4.31-2.22-7.72-5.5-10.02-9.66c-2.54-4.58-3.43-8.99-3.43-18.18l0,0l0.01-14.27c0.08-8.33,1-12.53,3.42-16.9
	c2.3-4.15,5.71-7.44,10.02-9.66c3.39-1.75,6.59-2.65,11.48-3.05l0,0l0.2-0.02l1.9-2.56c2.46-3.33,6.34-5.39,10.54-5.63l0,0
	l0.84-0.02H60.77z M60.77,15.86H39.58c-1.75,0-3.4,0.82-4.42,2.19l0,0l-1.97,2.67c-0.3,0.4-0.58,0.81-0.83,1.22
	c-0.74,1.18-2.03,1.92-3.46,1.99c-5.09,0.24-7.52,0.83-10.24,2.23c-2.82,1.45-5,3.56-6.51,6.27l0,0L11.9,32.9l-0.45,0.93
	c-0.84,1.88-1.32,3.96-1.55,7.16l0,0L9.8,42.68l-0.05,1.91c-0.01,0.67-0.02,1.39-0.02,2.14v12.99l0.02,2.14l0.05,1.91l0.09,1.69
	c0.29,3.99,0.97,6.24,2.25,8.55c1.51,2.71,3.69,4.82,6.51,6.27c2.39,1.23,4.72,1.89,8.87,2.17l0,0l1.76,0.09l1.98,0.05l2.22,0.02
	h33.43l2.22-0.02l1.98-0.05l1.76-0.09c4.14-0.28,6.48-0.94,8.87-2.17c2.82-1.45,5-3.56,6.51-6.27c1.28-2.3,1.96-4.55,2.25-8.55l0,0
	l0.09-1.69l0.05-1.91l0.02-2.14V46.72l-0.02-2.14l-0.05-1.91l-0.09-1.69c-0.23-3.19-0.71-5.27-1.55-7.16l0,0l-0.45-0.93l-0.25-0.46
	c-1.51-2.71-3.69-4.82-6.51-6.27c-2.73-1.41-5.17-2-10.29-2.24c-1.42-0.07-2.71-0.81-3.45-1.98c-0.26-0.42-0.54-0.83-0.84-1.23l0,0
	l-1.97-2.67C64.17,16.68,62.52,15.86,60.77,15.86L60.77,15.86z M50.27,33.95c10.72,0,19.47,8.12,19.47,18.22
	s-8.75,18.22-19.47,18.22S30.8,62.26,30.8,52.16S39.56,33.95,50.27,33.95z M50.27,42.2c-6.06,0-10.91,4.5-10.91,9.97
	s4.85,9.97,10.91,9.97s10.91-4.5,10.91-9.97S56.34,42.2,50.27,42.2z"/>
</svg>
`;

const volume = `
<svg version="1.1" id="音量" xmlns="http://www.w3.org/2000/svg"
xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
width="100px" height="100px" viewBox="0 0 100 100"
xml:space="preserve">
<g stroke-width="9" fill="none" stroke-linejoin="round" stroke-linecap="round"
  fill-rule="evenodd" stroke="#000000">
<path d="M24.56,30.33H10.06c-4,0-7.24,3.24-7.24,7.24v23.76c0,4,3.24,7.24,7.24,7.24h14.49l20.01,20.01
c0.95,0.95,2.48,0.95,3.43,0c0.45-0.45,0.71-1.07,0.71-1.71V12.04c0-1.34-1.09-2.42-2.42-2.42c-0.64,0-1.26,0.26-1.71,0.71
L24.56,30.33z M82.69,15.65C91.85,24.51,97.02,36.71,97,49.45c0.02,12.75-5.15,24.95-14.31,33.81 M68.02,27.61
c5.96,5.57,9.66,13.3,9.66,21.84c0,8.43-3.61,16.07-9.44,21.63"/>
</g>
</svg>
`;
const volume_mute = ` 
<svg version="1.1" id="静音" xmlns="http://www.w3.org/2000/svg" style="display: none"
xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
width="100px" height="100px" viewBox="0 0 100 100" xml:space="preserve">
<g stroke-width="9" fill="none" stroke-linejoin="round" stroke-linecap="round"
fill-rule="evenodd" stroke="#000000">
<path d="M24.97,29.84H10.32C6.28,29.84,3,33.11,3,37.16v24.02c0,4.04,3.28,7.32,7.32,7.32h14.65L45.2,88.73
c0.96,0.96,2.51,0.96,3.47,0c0.46-0.46,0.72-1.08,0.72-1.73V11.34c0-1.35-1.1-2.45-2.45-2.45c-0.65,0-1.27,0.26-1.73,0.72
L24.97,29.84z M67.7,34.52L97,63.82 M97,34.52l-29.3,29.3"/>
</g>
</svg>

`;

const full_screen = `
<svg version="1.1" id="全屏" xmlns="http://www.w3.org/2000/svg"
xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
width="100px" height="100px" viewBox="0 0 100 100"
xml:space="preserve">
<path d="M4.23,71.21v18.18c0,3.35,2.73,6.06,6.1,6.06h18.3 M28.63,4.55H10.32c-3.37,0-6.1,2.72-6.1,6.06v18.17l0,0 M95.78,71.21
v18.18c0,3.35-2.73,6.06-6.1,6.06H71.37l0,0 M71.37,4.55h18.31c3.36,0,6.1,2.71,6.1,6.06v18.18l0,0"/>
</svg>
`;
const exit_full_screen = `   
<svg version="1.1" id="退出全屏" label="退出全屏" xmlns="http://www.w3.org/2000/svg" style="display: none"
                         xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                         width="100px" height="100px" viewBox="0 0 100 100" xml:space="preserve">
<g>
	<path d="M29.65,91.93V74.95c0-3.13-2.54-5.66-5.66-5.66H7l0,0 M7,29.65h16.99c3.13,0,5.66-2.54,5.66-5.67l0,0V7l0,0
		 M69.29,91.93V74.94c0-3.13,2.53-5.66,5.66-5.66h16.99 M91.93,29.65H74.95c-3.13,0-5.66-2.54-5.66-5.66c0,0,0,0,0-0.01V7l0,0"/>
</g>
</svg>
`;

/**
 * Time: 2023-06-23 01:00 PM
 * Author: dinglong
 */



/**
 * 格式化视频时长
 * @param {string} 视频时长 
 * @returns timestr
 * @example 1:20:12
 */
const formatTime = (params) => {
    const hour = Math.floor(params / 3600);
    const minutes = Math.floor(params / 60 % 60);
    const seconds = Math.floor(params % 60);
    const hourStr = hour > 0 ? hour + ":" : '';
    const minutesStr = minutes > 9 ? minutes : '0' + minutes;
    const secondsStr = seconds > 9 ? seconds : '0' + seconds;
    const timeStr = `${hourStr}${minutesStr}:${secondsStr}`;
    return timeStr;
};
/**
 * 根据视频地址得到视频后缀名
 * @param {string} 视频地址链接 
 * @returns str
 * @example .mp4
 */
const formatVideo = (params) => {
    if (params === undefined || params === null || params === "") {
        return ""
    }
    let idx = params.lastIndexOf(".");
    if (idx != -1) {
        let str = params.slice(idx);
        return str
    }
};
/**
 * 判断是否为 dom 节点
 * @param {String}
 * @returns boolean
 */
const isDom = (dom) => {
    if (dom === null || dom === undefined) {
        throw new Error("元素不存在")
    }
    if (typeof dom === "string") {
        return true
    }
    if (typeof dom === "object" && dom.nodeName === "string" && dom.nodeType === 1) {
        return false
    }
};
/***
 * 判断移动端 PC端
 * @param {null}
 * @returns boolean
 */
const isPc = () => {
    if (window.navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)) {
        return false; // 移动端
    } else {
        return true; // PC端
    }
};

class paramsRules {
    constructor(arg) {
        const { style,islive,url } = arg;
        this.style = style;
        this.islive = islive || false;
        this.url = url;
        this.styleRulus();
    }
    styleRulus(){
        if(!this.style){
            return []
        }
        if(Object.prototype.toString.call(this.style) === '[object Object]'){
            let arr = [];
            Object.keys(this.style).map((v,i)=>{
                let value = Object.values(this.style)[i];
                if(typeof value != 'string'){
                    throw new Error(`${v}数据类型错误，期待数据类型值[string]`)
                }
                arr.push({key:v,value});
            });
           return arr
           
        }else {
            throw new Error(`[style]数据类型错误，期待数据类型值[object]`)
        }
    }
    
    isBool(){
        if(typeof this.islive === 'boolean'){
            return true
        }else {
            return false
        }
    }
    urlRules(){
        let is = Object.prototype.toString.call(this.url);
        if(is === '[object String]' || is === "[object Array]"){
            return is
        }else {
            throw new Error(`[url]数据类型错误，期待数据类型值[String or Array]`)
        }
    }
}

// import "../style/style.css"
class CreateVeoNode extends paramsRules {
    #PLAY_LABEL = "播放"
    #PAUSE_LABEL = "暂停"
    #SPEED_LABEL = "倍速"
    #DOWNLOAD_LABEL = "下载"
    #SETTING_LABEL = "设置"
    #LOOP_LABEL = "循环播放"
    #PIP_LABEL = "画中画"
    #CAPTURE_LABEL = "截图"
    #FULL_SCREEN_LABEL = "全屏"
    #EXIT_FULL_SCREEN_LABEL = "退出全屏"
    #VOLUME_LABEL = "音量"
    #VOLUME_MUTE_LABEL = "静音"
    #VIDEO_FORMAT_LIST = [".m3u8", ".mp4", ".webm"]
    constructor(arg) {
        let { id, style, url, width,plugins, islive, height, speed, autoplay, setting: settings } = arg;
        super(arg);
        this.idNode = id;
        this.style = style;
        this.url = url;
        this.plugins = plugins || [];
        this.islive = islive;
        this.width = width || 665;
        this.height = height || 440;
        this.speed = speed || [2, 1.5, 1, 0.75, 0.5];
        this.autoplay = autoplay;
        this.settings = settings || ["loop"];
        this.#createParentNode();
    }
    /**
     * 返回根元素
     * @returns ElementNode
     */
    getParentNode() {
        let isNode = isDom(this.idNode);
        return isNode ? document.getElementById(this.idNode) : this.idNode
    }

    /**
     * 创建根节点
     */
    #createParentNode() {
        const parentNode = this.getParentNode();
        this.styleArr = this.styleRulus();
        this.styleArr.map(v => {
            if (v.key === "themeColor") {
                parentNode.style.setProperty("--veo-color-primary", v.value || '#fff');
            }
            if (v.key === "processColor") {
                parentNode.style.setProperty("--veo-process-color", v.value);
            }
        });
        parentNode.setAttribute("class", "veo-container veo-control-isshow");
        parentNode.style.setProperty("width", this.width + "px");
        parentNode.style.setProperty("height", this.height + "px");
        const veoVideo = document.createElement("div");
        veoVideo.setAttribute("class", "veo-video");
        veoVideo.setAttribute("data-type", "play");
        parentNode.appendChild(veoVideo);
        this.#createVideoNode(veoVideo);

        this.#createPoster();
        this.#createErrorNode();
        this.#createLoadingNode();
        this.#createControlNode();

    }
    /**
     * 创建【视频】节点
     */
    #createVideoNode(veoVideo) {
        const video = document.createElement("video");
        const urlR = this.urlRules();
        if (!urlR) return
        const suffix = formatVideo(this.url);
        const sourceaAdd = (i) => {
            const source = document.createElement("source");
            source.setAttribute("type", "video/mp4");
            video.autoplay = this.autoplay;
            source.src = i === "string" ? this.url : this.url[i];
            video.appendChild(source);
        };

        if (urlR === "[object String]") {
            if (suffix.includes(".m3u8")) {
                let hls = new Hls();
                hls.loadSource(this.url);
                hls.attachMedia(video);

            } else {
                sourceaAdd("string");
            }
        } else if (urlR === "[object Array]") {
            for (let i = 0; i < this.url.length; i++) {
                sourceaAdd(i);
            }
        }



        video.setAttribute("crossorigin", "anonymous");
        veoVideo.appendChild(video);
    }
    /**
     * 创建 【封面】 节点
     */
    #createPoster() {
        const parentNode = this.getParentNode();
        const veoPoster = document.createElement("div");
        veoPoster.setAttribute("class", "veo-poster");
        const veoPosterBg = document.createElement("div");
        veoPosterBg.setAttribute("class", "veo-poster-bg");
        const veoPosterImg = document.createElement("img");
        veoPosterImg.setAttribute("class", "veo-poster-img");
        veoPosterBg.appendChild(veoPosterImg);
        veoPoster.appendChild(veoPosterBg);
        parentNode.appendChild(veoPoster);
    }
    /**
     * 创建 【错误】节点
     */
    #createErrorNode() {
        const parentNode = this.getParentNode();
        const veoError = document.createElement("div");
        veoError.setAttribute("class", "veo-error");
        parentNode.appendChild(veoError);
        veoError.innerHTML = error_close;
        const veoErrorMsg = document.createElement("span");
        veoErrorMsg.setAttribute("class", "veo-error-msg");
        veoError.appendChild(veoErrorMsg);
    }
    /**
     * 创建 【加载】 节点
     */
    #createLoadingNode() {
        const parentNode = this.getParentNode();
        const veoLoading = document.createElement("div");
        veoLoading.setAttribute("class", "veo-loading");
        veoLoading.innerHTML = veo_loading;
        parentNode.appendChild(veoLoading);
        this.#createIsPlay();
    }
    /**
     * 创建容器播放交互 节点
     */
    #createIsPlay() {
        const parentNode = this.getParentNode();
        const veoMutual = document.createElement("div");
        veoMutual.setAttribute("class", "veo-mutual");
        const veoMplay = document.createElement("div");
        veoMutual.appendChild(veoMplay);
        veoMplay.setAttribute("class", "veo-mutual-play");
        veoMplay.innerHTML = play_mutual;
        const veoMpause = document.createElement("div");
        veoMutual.appendChild(veoMpause);
        veoMpause.setAttribute("class", "veo-mutual-pause");
        veoMpause.innerHTML = pause_mutual;
        parentNode.appendChild(veoMutual);
    }
    /**
     * 创建 【底部控制区】 节点
     * @returns {ElementNode} VEO_PROCESS_CON_NODE, VEO_PLAYER_CON_NODE
     */
    #createControlNode() {
        const parentNode = this.getParentNode();
        const veoControl = document.createElement("div");
        parentNode.appendChild(veoControl);
        veoControl.setAttribute("class", "veo-control");
        if (!this.isBool()) {
            const veoProcessCon = document.createElement("div");
            veoProcessCon.setAttribute("class", "veo-process-con");
            veoControl.appendChild(veoProcessCon);
            this.#createProgressNode();
        }
        const veoPlayerCon = document.createElement("div");
        veoPlayerCon.setAttribute("class", "veo-player-con");
        veoControl.appendChild(veoPlayerCon);
        /*-------------*/
        this.#getControlNode();
        this.#createPlayerNode();

    }
    /**
     * @returns {Object} 返回底部控制区域
     */
    #getControlNode() {
        const parentNode = this.getParentNode();
        return {
            VEO_PROCESS_CON_NODE: parentNode.getElementsByClassName("veo-process-con")[0],
            VEO_PLAYER_CON_NODE: parentNode.getElementsByClassName("veo-player-con")[0]
        }
    }
    /**
     * 创建 【进度条】区域
     */
    #createProgressNode() {
        const { VEO_PROCESS_CON_NODE } = this.#getControlNode();
        const VEO_PROCESS_LIST = [
            "veo-process-out",
            "veo-process-ing",
            "veo-process-buff",
            "veo-process-sub",
            "veo-process-time-slide"];
        for (let i = 0; i < VEO_PROCESS_LIST.length; i++) {
            const veoProcess = document.createElement("div");
            veoProcess.setAttribute("class", VEO_PROCESS_LIST[i]);
            VEO_PROCESS_CON_NODE.appendChild(veoProcess);
            let pro = this.styleArr.find(v => v.key === "processColor");
            if (pro) {
                if (i === 1 || i === 3) {
                    veoProcess.style.setProperty("background", pro.value);
                    veoProcess.setAttribute("data-color", pro.value);
                }
            }
        }
    }
    /**
     * 创建 【播放区域】节点
     */
    #createPlayerNode() {
        const { VEO_PLAYER_CON_NODE } = this.#getControlNode();
        const VEO_PLAYER_LIST = [
            "veo-left-control",
            "veo-center-control",
            "veo-right-control",
        ];
        for (let i = 0; i < VEO_PLAYER_LIST.length; i++) {
            const veoPlayer = document.createElement("div");
            veoPlayer.setAttribute("class", VEO_PLAYER_LIST[i]);
            VEO_PLAYER_CON_NODE.appendChild(veoPlayer);
        }
        this.#createPlayPauseNode();
        if (!this.isBool()) {
            for (let i = 0; i < this.plugins.length; i++) {
                let item = this.plugins[i];
                if(item === "speed") {
                    this.#createSpeedNode();
                }
                if(item === "download") {
                    this.#createDownloadNode();
                }
                if(item === "setting"){
                    this.#createSettingNode();
                }
                if(item === "capture"){
                    this.#createCameraNode();
                }
            }
        }
        this.#createVolumeNode();
        this.#createFullScreenNode();
    }
    /**
     * @returns {Object} 返回底部左中右区域
     */
    #getLeftCnterRightNode() {
        const parentNode = this.getParentNode();
        return {
            VEO_LEFT_CONTROL_NODE: parentNode.getElementsByClassName("veo-left-control")[0],
            VEO_CENTER_CONTROL_NODE: parentNode.getElementsByClassName("veo-center-control")[0],
            VEO_RIGHT_CONTROL_NODE: parentNode.getElementsByClassName("veo-right-control")[0]
        }
    }
    /**
     * 创建 【播放 & 暂停 & 时长】节点
     */
    #createPlayPauseNode() {
        const { VEO_LEFT_CONTROL_NODE } = this.#getLeftCnterRightNode();
        const veoPlayPause = document.createElement("div");
        veoPlayPause.setAttribute("class", "veo-play-pause");
        veoPlayPause.setAttribute("label", this.#PAUSE_LABEL);
        veoPlayPause.setAttribute("data-type", "play");
        veoPlayPause.innerHTML = play + pause;
        VEO_LEFT_CONTROL_NODE.appendChild(veoPlayPause);
        this.#createDurationNode();
    }
    /**
     * 创建 【时长】节点
     */
    #createDurationNode() {
        const { VEO_LEFT_CONTROL_NODE } = this.#getLeftCnterRightNode();
        const veoTime = document.createElement("div");
        veoTime.setAttribute("class", "veo-time");
        VEO_LEFT_CONTROL_NODE.appendChild(veoTime);
        let VEO_TIME_LIST = [
            "veo-time-ing",
            "veo-slash",
            "veo-time-total",
        ];
        if (this.isBool()) {
            VEO_TIME_LIST.splice(1, 2);
        }
        for (let i = 0; i < VEO_TIME_LIST.length; i++) {
            const veoTimeNode = document.createElement("div");
            veoTimeNode.setAttribute("class", VEO_TIME_LIST[i]);
            veoTime.appendChild(veoTimeNode);
            if (i === 0) {
                veoTimeNode.innerHTML = "00:00";
            }
            if (i === 1) {
                veoTimeNode.innerHTML = "/";
            }
            if (i === 2) {
                const span = document.createElement("span");
                veoTimeNode.innerHTML = time_loading + error_time;
                veoTimeNode.appendChild(span);
            }
        }
    }
    /**
    * 待定
    */
    #createCenterNode() { }
    /**
     * 创建 【倍速播放】节点 
     */
    #createSpeedNode() {
        const { VEO_RIGHT_CONTROL_NODE } = this.#getLeftCnterRightNode();
        const veoSpeed = document.createElement("div");
        veoSpeed.setAttribute("class", "veo-speed");
        veoSpeed.setAttribute("label", this.#SPEED_LABEL);
        VEO_RIGHT_CONTROL_NODE.appendChild(veoSpeed);
        const veoSpeedSpan = document.createElement("span");
        veoSpeedSpan.innerHTML = this.#SPEED_LABEL;
        veoSpeed.appendChild(veoSpeedSpan);
        const veoSpeedOutcon = document.createElement("div");
        veoSpeedOutcon.setAttribute("class", "veo-speed-outcon");
        veoSpeed.appendChild(veoSpeedOutcon);
        const veoSpeedIncon = document.createElement("div");
        veoSpeedIncon.setAttribute("class", "veo-speed-incon");
        veoSpeedOutcon.appendChild(veoSpeedIncon);
        const SPEED_TOTAL = this.speed;
        for (let i = 0; i < SPEED_TOTAL.length; i++) {
            const veoSpeedItem = document.createElement("div");
            const itemSpan = document.createElement("span");
            veoSpeedItem.setAttribute("class", "veo-speed-item");
            veoSpeedIncon.appendChild(veoSpeedItem);
            veoSpeedItem.appendChild(itemSpan);
            itemSpan.innerHTML = SPEED_TOTAL[i] + 'x';
            veoSpeedItem.innerHTML = strike + itemSpan.outerHTML;
            if (SPEED_TOTAL[i] === 1) {
                veoSpeedItem.setAttribute("class", "veo-speed-item veo-speed-active");
            }
        }
    }
    /**
     * 创建 【下载】节点
     */
    #createDownloadNode() {
        const { VEO_RIGHT_CONTROL_NODE } = this.#getLeftCnterRightNode();
        const veoDownload = document.createElement("div");
        veoDownload.setAttribute("class", "veo-download");
        veoDownload.setAttribute("label", this.#DOWNLOAD_LABEL);
        veoDownload.innerHTML = download;
        VEO_RIGHT_CONTROL_NODE.appendChild(veoDownload);
    }
    /**
     * 创建 【设置】节点
     */
    #createSettingNode() {
        const { VEO_RIGHT_CONTROL_NODE } = this.#getLeftCnterRightNode();
        const veoSetting = document.createElement("div");
        veoSetting.setAttribute("class", "veo-setting");
        veoSetting.setAttribute("label", this.#SETTING_LABEL);
        veoSetting.innerHTML = setting;
        const veoSettingOutcon = document.createElement("div");
        veoSettingOutcon.setAttribute("class", "veo-setting-outcon");
        const veoSettingIncon = document.createElement("div");
        veoSettingIncon.setAttribute("class", "veo-setting-incon");
        veoSettingOutcon.appendChild(veoSettingIncon);
        veoSetting.appendChild(veoSettingOutcon);
        const VEO_SETT_LIST = this.settings;
        for (let i = 0; i < VEO_SETT_LIST.length; i++) {
            const veoSettingItem = document.createElement("div");
            const itemSpan = document.createElement("span");
            veoSettingItem.setAttribute("class", "veo-setting-item");
            veoSettingIncon.appendChild(veoSettingItem);
            veoSettingItem.appendChild(itemSpan);
            // 开关
            const veoSwitch = document.createElement("div");
            veoSwitch.setAttribute("class", "veo-switch");
            veoSwitch.setAttribute("data-name", VEO_SETT_LIST[i]);
            veoSwitch.setAttribute("data-state", '');
            veoSettingItem.appendChild(veoSwitch);
            const veoSwitchBar = document.createElement("div");
            veoSwitchBar.setAttribute("class", "veo-switch-bar");
            veoSwitch.appendChild(veoSwitchBar);
            if (VEO_SETT_LIST[i] === "loop") {
                itemSpan.innerHTML = this.#LOOP_LABEL;
            }
            if (VEO_SETT_LIST[i] === "pip") {
                itemSpan.innerHTML = this.#PIP_LABEL;
            }
        }
        VEO_RIGHT_CONTROL_NODE.appendChild(veoSetting);
    }
    /**
     * 创建 【截图】节点
     */
    #createCameraNode() {
        const { VEO_RIGHT_CONTROL_NODE } = this.#getLeftCnterRightNode();
        const veoCapture = document.createElement("div");
        veoCapture.setAttribute("class", "veo-capture");
        veoCapture.setAttribute("label", this.#CAPTURE_LABEL);
        veoCapture.innerHTML = capture;
        VEO_RIGHT_CONTROL_NODE.appendChild(veoCapture);
    }
    /**
     * 创建 【音量】节点
     */
    #createVolumeNode() {
        const { VEO_RIGHT_CONTROL_NODE } = this.#getLeftCnterRightNode();
        const veoVolume = document.createElement("div");
        veoVolume.setAttribute("class", "veo-volume");
        veoVolume.setAttribute("label", this.#VOLUME_LABEL);
        veoVolume.innerHTML = volume + volume_mute;

        const veoVolumeOutcon = document.createElement("div");
        veoVolumeOutcon.setAttribute("class", "veo-volume-outcon");
        const veoVolumeIncon = document.createElement("div");
        veoVolumeIncon.setAttribute("class", "veo-volume-incon");
        veoVolumeOutcon.appendChild(veoVolumeIncon);
        const veoVolumePertxt = document.createElement("div");
        veoVolumePertxt.setAttribute("class", "veo-volume-pertxt");
        veoVolumePertxt.innerHTML = "100%";
        veoVolumeIncon.appendChild(veoVolumePertxt);
        const veoVolumeProgressCon = document.createElement("div");
        veoVolumeProgressCon.setAttribute("class", "veo-volume-progress-con");
        veoVolumeIncon.appendChild(veoVolumeProgressCon);
        const veoVolumeProgress = document.createElement("div");
        veoVolumeProgress.setAttribute("class", "veo-volume-progress");
        veoVolumeProgressCon.appendChild(veoVolumeProgress);
        const veoVolumeProgressLine = document.createElement("div");
        veoVolumeProgressLine.setAttribute("class", "veo-volume-progress-line");
        veoVolumeProgress.appendChild(veoVolumeProgressLine);
        const veoVolumeProgressIng = document.createElement("div");
        veoVolumeProgressIng.setAttribute("class", "veo-volume-progress-ing");
        veoVolumeProgress.appendChild(veoVolumeProgressIng);
        const veoVolumeProgressBar = document.createElement("div");
        veoVolumeProgressBar.setAttribute("class", "veo-volume-progress-bar");
        veoVolumeProgressCon.appendChild(veoVolumeProgressBar);
        veoVolume.appendChild(veoVolumeOutcon);
        VEO_RIGHT_CONTROL_NODE.appendChild(veoVolume);
        let v = veoVolume.getElementsByTagName("svg");
        v[0].setAttribute("data-val", "volume");
        v[1].setAttribute("data-val", "volume-mute");

    }
    /**
     * 创建 【全屏 & 退出全屏】节点
     */
    #createFullScreenNode() {
        const { VEO_RIGHT_CONTROL_NODE } = this.#getLeftCnterRightNode();
        const veoScreen = document.createElement("div");
        veoScreen.setAttribute("class", "veo-screen");
        veoScreen.setAttribute("label", this.#FULL_SCREEN_LABEL);
        veoScreen.setAttribute("data-index", "1");
        veoScreen.innerHTML = full_screen + exit_full_screen;
        VEO_RIGHT_CONTROL_NODE.appendChild(veoScreen);
    }
}

class VeoPlayer extends CreateVeoNode {
    durationTime = 1
    PERCENTILE = 100 // 百分比
    SLIDE_OFFSET = 0.8 // 提示滑块偏移量
    VOLUME_LEN = 100 // 音量总长
    isNode = true;
    constructor(arg) {
        let { id, poster, volume, style, plugins, islive, url, width, height, speed, autoplay, setting } = arg;
        
        super(arg);
        this.id = id;
        this.isNode = isDom(id);
        this.poster = poster || null;
        this.url = url;
        this.islive = islive;
        this.width = width;
        this.height = height;
        this.speed = speed;
        this.autoplay = autoplay;
        this.volume = volume || 70;
        this.#initNode();
        this.#initPlayer();
    }

    #initNode() {
        let veoContainer = this.isNode ? document.getElementById(this.id) : this.id;
        let veo = veoContainer.querySelector("video");
        let veoPoster = veoContainer.querySelector(".veo-poster");
        let veoPosterImg = veoContainer.querySelector(".veo-poster-img");
        let veoControl = veoContainer.querySelector(".veo-control");
        let veoCon = veoContainer.querySelector(".veo-process-con");
        let veoIng = veoContainer.querySelector(".veo-process-ing");
        let veoOut = veoContainer.querySelector(".veo-process-out");
        let veoSub = veoContainer.querySelector(".veo-process-sub");
        let veoBuff = veoContainer.querySelector(".veo-process-buff");
        let veoTimeSlide = veoContainer.querySelector(".veo-process-time-slide");
        let veoTimeTotal = veoContainer.querySelector(".veo-time-total");
        let veoTimeSvgs = veoContainer.querySelectorAll(".veo-time-total svg");
        let veoErrorMsg = veoContainer.querySelector(".veo-error-msg");
        let veoError = veoContainer.querySelector(".veo-error");
        let veoVideo = veoContainer.querySelector(".veo-video");
        let veoLoading = veoContainer.querySelector(".veo-loading");
        let veoTimeIng = veoContainer.querySelector(".veo-time-ing");
        let veoSlash = veoContainer.querySelector(".veo-slash");
        let veoPlayPause = veoContainer.querySelector(".veo-play-pause");
        let veoScreen = veoContainer.querySelector(".veo-screen");
        let veoCapture = veoContainer.querySelector(".veo-capture");
        let veoSpeed = veoContainer.querySelector(".veo-speed");
        let veoSpeedCon = veoContainer.querySelector(".veo-speed-outcon");
        let veoVolume = veoContainer.querySelector(".veo-volume");

        let veoVolumeProgress = veoContainer.querySelector(".veo-volume-progress");
        let veoVolumeProgressPertxt = veoContainer.querySelector(".veo-volume-pertxt");
        let veoVolumeProgressLine = veoContainer.querySelector(".veo-volume-progress-line");
        let veoVolumeProgressIng = veoContainer.querySelector(".veo-volume-progress-ing");
        let veoVolumeProgressBar = veoContainer.querySelector(".veo-volume-progress-bar");
        let veoVolumeOutcon = veoContainer.querySelector(".veo-volume-outcon");
        let veoSetting = veoContainer.querySelector(".veo-setting");
        let veoSettingOutcon = veoContainer.querySelector(".veo-setting-outcon");
        let veoDownload = veoContainer.querySelector(".veo-download");
        let veoSpeedItemNode = veoContainer.querySelectorAll(".veo-speed-item");
        let veoSwitch = veoContainer.querySelectorAll(".veo-switch");
        let veoMutualPlay = veoContainer.querySelector(".veo-mutual-play");
        let veoMutualPause = veoContainer.querySelector(".veo-mutual-pause");
        return {
            veoContainer,
            veo,
            veoControl,
            veoPoster,
            veoPosterImg,
            veoCon,
            veoIng,
            veoSlash,
            veoOut,
            veoSub,
            veoVideo,
            veoBuff,
            veoTimeSlide,
            veoTimeTotal,
            veoTimeSvgs,
            veoErrorMsg,
            veoError,
            veoLoading,
            veoTimeIng,
            veoPlayPause,
            veoScreen,
            veoCapture,
            veoSpeed,
            veoSpeedCon,
            veoVolume,
            veoVolumeOutcon,
            veoVolumeProgress,
            veoVolumeProgressPertxt,
            veoVolumeProgressLine,
            veoVolumeProgressIng,
            veoVolumeProgressBar,
            veoSetting,
            veoSettingOutcon,
            veoDownload,
            veoSpeedItemNode,
            veoSwitch,
            veoMutualPlay,
            veoMutualPause
        }
    }

    #initPlayer() {
        let { veo, veoSpeed, veoDownload, veoCapture, veoSpeedCon, veoSetting, veoSettingOutcon, veoVolume, veoVolumeOutcon } = this.#initNode();
        veo.volume = this.volume / 100;
        this.veoLoadStart();
        this.veoLoaded();
        this.#containerMouse();
        this.veoWaiting();
        this.veoError();
        this.veoPlaying();
        if (!this.isBool()) {
            this.#veoMouseTime();
            if (veoSpeed != null) {
                this.#veoSpeedNode();
                this.#mouseInout(veoSpeed, veoSpeedCon, "opacity");
            }
            if (veoDownload != null) {
                this.#voeDownLoad();
            }
            if (veoSetting != null) {
                this.#handleVeoSetting();
            }
            if (veoCapture != null) {
                this.#veoCapture();
                this.#mouseInout(veoSetting, veoSettingOutcon, "opacity");
            }
        }
        this.#veoPlayPause();
        this.#veoConPlay();
        this.veoPlayEnded();
        this.#veoScreen();
        this.#veoKeyCode();

        this.#veoVolume();

        this.#mouseInout(veoVolume, veoVolumeOutcon, "opacity");
    }
    /**
     * method
     * 视频预加载
     */
    veoLoadStart(callback) {
        let {
            veo,
            veoLoading
        } = this.#initNode();
        veo.addEventListener('loadstart', (e) => {
            if (callback) {
                callback(e);
            }
            veoLoading.style.display = 'block';
            this.#voeInitVolume('init');
        });
    }
    /**
     * method
     * 视频预加载
     */
    veoLoaded(callback) {
        let {
            veo,
            veoTimeTotal,
            veoLoading
        } = this.#initNode();

        veo.addEventListener('loadedmetadata', (e) => {
            if (callback) {
                callback(e);
            }

            let duration = e.target.duration;
            // Infinity 超出无穷大 或为 视频实时
            if (this.isBool() === false && duration != Infinity) {
                let spanNode = veoTimeTotal.querySelector("span");
                let svgNode = veoTimeTotal.querySelectorAll("svg");
                this.durationTime = duration;
                let time = formatTime(duration);
                svgNode[0].style.display = svgNode[1].style.display = veoLoading.style.display = 'none';
                spanNode.innerHTML = time;
                this.veoProgressBuffer();
                this.#veoProcessOffset();

            } else {
                veoLoading.style.display = 'none';
            }
            if (this.autoplay) {
                this.#veoPlayPauseNode("play");
            } else {
                this.#veoPlayPauseNode("pause");
            }
            this.veoTimeUpdate();


            // 截取第一帧作为封面
            setTimeout(() => {
                let canvas = document.createElement('canvas');
                let width = veo.offsetWidth;
                let height = veo.offsetHeight;
                canvas.width = width;
                canvas.height = height;
                canvas.getContext('2d').drawImage(veo, 0, 0, width, height);
                let dataURL = canvas.toDataURL('image/png');
                if (!this.poster) {
                    this.poster = dataURL;
                }
                this.#veoPoster();
            }, 2000);


        });
    }

    /**
     * 容器的滑入滑出
     */
    #containerMouse() {
        let { veoControl, veoScreen, veoContainer, veoVideo } = this.#initNode();
        veoContainer.addEventListener("mouseenter", (e) => {
            veoContainer.classList.add("veo-control-isshow");
        });
        veoControl.addEventListener("mouseenter", (e) => {
            veoContainer.classList.add("veo-control-isshow");
        });
        veoContainer.addEventListener("mouseleave", (e) => {
            if (veoVideo.dataset.type === "play") {
                return
            }
            veoContainer.classList.remove("veo-control-isshow");
        });
        // let index = veoScreen.dataset.index
        // veoVideo.addEventListener("mousemove", (e) => {
        //     veoContainer.classList.add("veo-control-isshow")
        //     if (index === '1' && this.isMouse) {
        //         setTimeout(() => {
        //             veoContainer.classList.remove("veo-control-isshow")
        //         }, 2000);
        //     }

        // })

    }

    /**
     * 视频封面背景
     */
    #veoPoster() {
        const { veoPosterImg } = this.#initNode();
        if (this.poster) {
            veoPosterImg.src = this.poster;
        }
    }

    /**
     * function
     * 视频加载错误
     */
    veoError(callback) {
        let { veoError, veo, veoErrorMsg, veoTimeSvgs, veoLoading } = this.#initNode();
        veo.addEventListener("error", (e) => {
            if (callback) {
                e.video_type = "video";
                callback(e);
            }
            veoTimeSvgs[0].style.display = veoLoading.style.display = 'none';
            veoTimeSvgs[1].style.display = 'block';
            veoError.style.display = 'flex';
            let { message } = e.target.error;
            veoErrorMsg.innerHTML = message;
        });
        let veosource = veo.querySelector("source");
        if (veosource) {
            veosource.addEventListener("error", (event) => {
                if (callback) {
                    event.video_type = "source";
                    callback(event);
                }
                veoTimeSvgs[0].style.display = veoLoading.style.display = 'none';
                veoTimeSvgs[1].style.display = 'block';
                veoError.style.display = 'flex';
                veoErrorMsg.innerHTML = "视频加载失败";
            });
        }

    }

    /**
     * method
     * 视频加载等待中
     */
    veoWaiting(callback) {
        let { veoLoading, veo } = this.#initNode();
        veo.addEventListener('waiting', function (e) {
            if (callback) {
                callback(e);
            }
            veoLoading.style.display = 'block';
        });
    }

    /**
     * method
     * 视频播放中
     */
    veoPlaying(callback) {
        let { veo, veoLoading } = this.#initNode();
        veo.addEventListener('playing', function (e) {
            if (callback) {
                callback(e);
            }
            veoLoading.style.display = 'none';
        });
    }

    /**
     * method
     * 进度条缓冲条
     */
    veoProgressBuffer(callback) {
        let { veoContainer, veo, veoBuff } = this.#initNode();
        veo.addEventListener("progress", (e) => {
            let hc = e.target.buffered.end(0);
            if (callback) {
                callback(e);
            }
            let w = veoContainer.offsetWidth;
            let buffWidth = (hc * w) / veo.duration;
            veoBuff.style.width = ((buffWidth / w) * 100) + "%";
        });
    }

    /**
     * 进度条时长提示
     */
    #veoMouseTime() {
        const { veoOut, veo, veoCon, veoTimeSlide } = this.#initNode();
        // 滑块移入
        veoOut.addEventListener("mousemove", (e) => {
            let x = e.offsetX;
            let veoConWidth = veoCon.offsetWidth;
            let duration = veo.duration || 0;
            let count = (x * duration) / veoConWidth;
            const timeStr = formatTime(count);
            veoTimeSlide.style.display = 'block';
            veoTimeSlide.setAttribute('data-slideFade', 'in');
            let veoSlideWidthHalf = veoTimeSlide.offsetWidth / 2;  // 时长提示块取半
            let left = (100 * (x - veoSlideWidthHalf)) / veoConWidth;
            veoTimeSlide.innerHTML = timeStr;
            // 判断时长提示块边界可用
            if ((x - veoSlideWidthHalf) > 0 && (x + veoSlideWidthHalf) < veoConWidth) {
                veoTimeSlide.style.left = left + '%';
            }
            // 小于0
            if (x - veoSlideWidthHalf < 0) {
                veoTimeSlide.style.left = '0%';
            }
            // 超出最大盒子限制
            if ((x + veoSlideWidthHalf) > veoConWidth) {
                let left = (veoConWidth * this.PERCENT) / (veoConWidth + veoTimeSlide.offsetWidth) - this.SLIDE_OFFSET;
                veoTimeSlide.style.left = left + '%';
            }
        });
        // 滑块移出
        veoOut.addEventListener("mouseout", (e) => {
            veoTimeSlide.setAttribute('data-slideFade', 'out');
            veoTimeSlide.style.display = 'none';
            veoTimeSlide.style.left = '';
        });
    }

    /**
     * 更改进度条位置
     */
    #veoProcessOffset() {
        const { veo, veoIng, veoCon, veoSub, veoTimeIng, veoContainer } = this.#initNode();


        let barX = 0;
        let barLeft = 0;
        let veoConWidth = veoContainer.offsetWidth;
        let duration = veo.duration;
        const elemMove = (e) => {
            const cx = e.clientX;
            let x = (cx - barX + barLeft);
            let offset = x / veoConWidth;
            if (offset > -1 && offset <= 1) {
                let currentTime = (duration * x) / veoConWidth;
                const ingWidth = x / veoConWidth;
                veoIng.style.width = (ingWidth * 100) + '%';
                veoSub.style.left = ((ingWidth * 100) - 0.5) + '%';
                let time = formatTime(currentTime);
                veoTimeIng.innerHTML = time;
                veo.currentTime = currentTime;
                this.#veoPlayPauseNode("play");
            }
        };

        let flag = false;
        veoSub.addEventListener("mousedown", (e) => {
            flag = true;
            barX = e.clientX;
            barLeft = e.target.offsetLeft;
            window.addEventListener("mousemove", elemMove);
        });
        window.addEventListener('mouseup', (e) => {
            window.removeEventListener("mousemove", elemMove);
        });
        veoSub.addEventListener("mouseup", (e) => {
            flag = true;
        });


        veoCon.addEventListener("click", (e) => {
            if (flag) return
            let veoConWidth = veoContainer.offsetWidth;
            let duration = veo.duration;
            let x = e.offsetX;
            let currentTime = (duration * x) / veoConWidth;
            const ingWidth = x / veoConWidth;
            veoIng.style.width = (ingWidth * 100) + '%';
            veoSub.style.left = ((ingWidth * 100) - 0.5) + '%';
            let time = formatTime(currentTime);
            veoTimeIng.innerHTML = time;
            veo.currentTime = currentTime;
            this.#veoPlayPauseNode("play");
        });
    }

    /**
     * 播放时长更改
     */
    veoTimeUpdate(callback) {
        const { veo, veoCon, veoIng, veoSub, veoTimeIng } = this.#initNode();

        veo.addEventListener("timeupdate", (e) => {
            let currentTime = veo.currentTime;
            if (veoCon != null) {
                let veoConWidth = veoCon.offsetWidth;
                let duration = veo.duration;
                const ingWidth = ((veoConWidth * currentTime) / duration) / veoConWidth;

                if (veoIng) {
                    veoIng.style.width = (ingWidth * 100) + '%';
                    veoSub.style.left = ((ingWidth * 100) - 0.5) + '%';
                }
            }

            let time = formatTime(currentTime);
            e.veoFormatTime = time;
            // 外部调用
            if (callback) {
                callback(e);
            }
            veoTimeIng.innerHTML = time;
        });
    }

    /**
     * 播放 暂停 Node操作
     */
    #veoPlayPauseNode(type) {
        const { veo, veoPlayPause, veoVideo } = this.#initNode();
        const nodeList = veoPlayPause.getElementsByTagName("svg");
        if (type === 'play') {
            veo.play();
            veoPlayPause.setAttribute("data-type", "pause");
            veoVideo.setAttribute("data-type", "pause");
            veoPlayPause.setAttribute("label", "暂停");
            nodeList[0].style.setProperty("display", "none");
            nodeList[1].style.setProperty("display", "block");
        } else {
            veo.pause();
            veoPlayPause.setAttribute("data-type", "play");
            veoVideo.setAttribute("data-type", "play");
            veoPlayPause.setAttribute("label", "播放");
            nodeList[0].style.setProperty("display", "block");
            nodeList[1].style.setProperty("display", "none");
        }
    }
    /**
     * 播放 暂停操作
     */
    #veoPlayPause() {
        const { veoPlayPause } = this.#initNode();
        veoPlayPause.addEventListener("click", (e) => {
            let { type } = e.target.dataset;
            this.#veoPlayPauseNode(type);
        });
        this.veoPlay();
        this.veoPause();
    }

    /**
     * method
     * 播放
     */
    veoPlay(callback) {
        const { veo } = this.#initNode();
        veo.addEventListener("play", (e) => {
            if (callback) {
                callback(e);
            }
        });
    }
    /**
     * method
     * 暂停
    */
    veoPause(callback) {
        const { veo } = this.#initNode();
        veo.addEventListener("pause", (e) => {
            if (callback) {
                callback(e);
            }
        });
    }
    /**
     * 容器播放
     */
    #veoConPlay() {
        const { veoVideo, veoMutualPlay, veoMutualPause } = this.#initNode();
        veoVideo.addEventListener("click", (e) => {
            let { type } = e.target.dataset;
            if (type === "play") {
                veoMutualPause.style.display = "block";
                setTimeout(() => {
                    veoMutualPause.style.display = "none";
                }, 1500);
            }
            if (type === "pause") {
                veoMutualPlay.style.display = "block";
                setTimeout(() => {
                    veoMutualPlay.style.display = "none";
                }, 1500);
            }
            this.#veoPlayPauseNode(type);
        });
    }

    /**
     * 播放结束
     */
    veoPlayEnded(callback) {
        const { veo, veoContainer } = this.#initNode();
        veo.addEventListener("ended", (e) => {
            if (callback) {
                callback(e);
            }
            veoContainer.classList.add("veo-control-isshow");
            this.#veoPlayPauseNode('pause');
        });
    }

    /**
     * 播放速度
     */
    #veoSpeedNode() {
        const { veo, veoSpeedItemNode } = this.#initNode();
        for (let i = 0; i < veoSpeedItemNode.length; i++) {
            veoSpeedItemNode[i].addEventListener("click", (e) => {
                for (let idx in veoSpeedItemNode) {
                    // 判断是否为DOM元素
                    if (typeof veoSpeedItemNode[idx] === 'object' && veoSpeedItemNode[idx] instanceof HTMLElement) {
                        veoSpeedItemNode[idx].classList.remove("veo-speed-active");
                    }
                }
                e.target.classList.add("veo-speed-active");
                veo.playbackRate = this.speed[i];
            });
        }
    }

    /**
     * 视频下载
     */
    #voeDownLoad() {
        const { veoDownload, veo } = this.#initNode();
        veoDownload.addEventListener("click", (e) => {

        });
    }

    /**
     * 设置开关
     */
    #handleVeoSetting() {
        const { veoSwitch, veo } = this.#initNode();
        for (let i = 0; i < veoSwitch.length; i++) {
            veoSwitch[i].addEventListener("click", (e) => {
                if (veoSwitch[i].classList.length === 1) {
                    veoSwitch[i].classList.add("veo-switch-active");
                } else {
                    veoSwitch[i].classList.remove("veo-switch-active");
                }
                let { name, state } = e.target.dataset;
                if (!name) {
                    throw new Error("切换name必传")
                }
                veoSwitch[i].toggleAttribute("data-state");
                if (name === 'pip') {
                    // 切换画中画显示
                    state === '' ? veo.requestPictureInPicture() : document.exitPictureInPicture();
                }
                if (name === 'loop') {
                    // 循环播放切换
                    state === '' ? veo.loop = true : veo.loop = false;
                }
            });
        }
    }

    /**
     * 移入移出
     */
    #mouseInout(el, node, type = "display") {
        el.addEventListener("mouseenter", () => {
            if (type === "display") {
                node.style.display = "block";
            } else {
                node.style.opacity = 1;
                node.style.visibility = "visible";
            }
        });
        el.addEventListener("mouseleave", () => {
            if (type === "display") {
                node.style.display = "none";
            } else {
                node.setAttribute("style", "");
            }
        });
    }

    /**
     * 截图
     */
    #veoCapture() {
        const { veo, veoCapture } = this.#initNode();
        const canvas = document.createElement('canvas');
        veoCapture.addEventListener("click", (e) => {
            canvas.width = this.width;
            canvas.height = this.height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(veo, 0, 0);
            let url = canvas.toDataURL('image/png');
            let a = document.createElement("a");
            const mouse = new MouseEvent("click");
            a.href = url;
            a.download = "capture-" + new Date().getTime();
            a.dispatchEvent(mouse);
        });
    }

    /**
     * 音量
     */
    #veoVolume() {
        const { veoVolume } = this.#initNode();
        const volumeList = veoVolume.getElementsByTagName("svg");
        this.#veoHandleVolume();
        for (let i = 0; i < volumeList.length; i++) {
            volumeList[i].addEventListener("click", (e) => {
                const { val } = e.target.dataset;
                if (val === "volume") {
                    volumeList[0].style.display = "none";
                    volumeList[1].style.display = "block";
                    this.#veoIsMuted(true);
                } else {
                    volumeList[0].style.display = "block";
                    volumeList[1].style.display = "none";
                    this.#veoIsMuted(false);
                }
            });
        }
    }

    /**
     * 设置静音
     */
    #veoIsMuted(isMuted) {
        const { veo } = this.#initNode();
        veo.muted = isMuted;
    }

    /**
     * 初始化音量
     */
    #voeInitVolume(type = 'init', eY) {

        const {
            veo,
            veoVolumeProgressPertxt,
            veoVolumeProgress,
            veoVolumeProgressIng,
            veoVolumeProgressBar
        } = this.#initNode();

        const volumeHeight = veoVolumeProgress.offsetHeight;
        let height = 0;
        let volumeNum = 0;
        if (type == 'init') {
            volumeNum = this.volume / this.VOLUME_LEN;
            height = ((volumeHeight * this.volume) / this.VOLUME_LEN) / volumeHeight * 100;
        } else {
            const y = volumeHeight - eY;
            volumeNum = ((this.VOLUME_LEN * y) / volumeHeight) / 100;
            height = (y / volumeHeight) * 100;
        }
        veo.volume = volumeNum;
        veoVolumeProgressIng.style.height = height + '%';
        veoVolumeProgressBar.style.bottom = (height - 8) + '%';
        veoVolumeProgressPertxt.innerHTML = (Math.floor(height)) + '%';
    }

    /**
     * 音量设置
     */
    #veoHandleVolume() {
        const { veoVolumeProgress, veoVolume, veoVolumeProgressBar } = this.#initNode();
        const volumeList = veoVolume.getElementsByTagName("svg");

        veoVolumeProgress.addEventListener("click", (e) => {
            let y = e.offsetY;
            this.#voeInitVolume(null, y);
        });

        let barY = 0;
        let barBottom = 0;
        const proHeight = veoVolumeProgress.offsetHeight;
        const elemMove = (e) => {
            const y = isPc() ? e.clientY : e.touches[0].clientY;
            let offset = (proHeight - (y - barY + barBottom));
            let by = (100 * offset) / proHeight;
            if (by > -1 && by <= 100) {
                this.#voeInitVolume(null, proHeight - offset);
                this.#veoIsMuted(false);
                volumeList[1].style.display = "none";
                volumeList[0].style.display = "block";
            }

            if (by <= 0) {
                this.#veoIsMuted(true);
                volumeList[0].style.display = "none";
                volumeList[1].style.display = "block";
            }
        };

        veoVolumeProgressBar.addEventListener(isPc() ? "mousedown" : "touchstart", (e) => {
            console.log(e);
            barY = isPc() ? e.clientY : e.touches[0].clientY;
            barBottom = e.target.offsetTop;
            window.addEventListener(isPc() ? "mousemove" : "touchmove", elemMove);
        });
        window.addEventListener(isPc() ? "mouseup" : "touchend", (e) => {
            window.removeEventListener(isPc() ? "mousemove" : "touchmove", elemMove);
        });

    }

    /**
     * 全屏
     */
    #veoScreen() {
        const { veoContainer, veoScreen } = this.#initNode();
        const screenFunc = (e) => {
            let isFullScreen = document.fullscreenElement;
            if (!isFullScreen) {
                veoContainer.requestFullscreen();
                // setTimeout(() => {
                //     veoContainer.classList.remove("veo-control-isshow")
                // }, 2000);
                veoScreen.dataset.index = 0;
                veoScreen.setAttribute("label", "退出");
            } else {
                document.exitFullscreen();
                veoScreen.dataset.index = 1;
                veoScreen.setAttribute("label", "全屏");
            }
        };
        veoScreen.addEventListener("click", (e) => {
            screenFunc();
        });
        veoContainer.addEventListener("dblclick", (e) => {
            screenFunc();
            this.#veoPlayPauseNode("play");
        });
    }

    /**
     * 键盘控制
     */
    #veoKeyCode() {
        const { veoPlayPause } = this.#initNode();

        document.addEventListener("keyup", (e) => {
            let { key } = e;
            if (key === " ") {
                let type = veoPlayPause.dataset.type;
                this.#veoPlayPauseNode(type);
            }
        });
    }
}

export { VeoPlayer as default };
